<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interface SCT-0001</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/styles.css">
    <script src="https://unpkg.com/signature_pad"></script>
    <script src="./scripts/tailwind-config.js"></script>
    <style>
        .step-track {
            background: #e6f4f1;
        }
        .step-progress-track {
            background: #b8d8d4;
            border-radius: 999px;
            height: 4px;
            overflow: hidden;
        }
        .step-progress-fill {
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(120deg, #2a9d8f, #264653);
            transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(38, 70, 85, 0.25);
        }
        .step-dot {
            transition: transform 0.4s ease, background 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
            background: #b8d8d4;
            color: #264653;
        }
        .step-dot-active {
            transform: scale(1.08);
            background: linear-gradient(135deg, #2a9d8f, #264653);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 12px 30px rgba(38, 83, 109, 0.35);
        }
        .step-label {
            transition: color 0.3s ease, opacity 0.3s ease;
            color: #264653;
        }
        .step-label-muted {
            opacity: 0.7;
            color: #4a555b;
        }
        #toast {
            top: 12px;
            bottom: auto;
            transform: translate(-50%, -120%);
        }
        #toast.toast-active {
            animation: slideDownUp 3s forwards;
        }
        @keyframes slideDownUp {
            0% {
                transform: translate(-50%, -120%);
                opacity: 0;
            }
            10% {
                transform: translate(-50%, 0);
                opacity: 1;
            }
            90% {
                transform: translate(-50%, 0);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -120%);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex overflow-hidden font-sans relative">

    <!-- OVERLAY MOBILE POUR SIDEBAR -->
    <div id="mobile-sidebar-backdrop" data-action="toggle-sidebar" class="fixed inset-0 bg-gray-900/50 z-30 hidden lg:hidden transition-opacity backdrop-blur-sm"></div>

    <!-- SIDEBAR (Responsive) -->
    <aside id="sidebar" class="absolute lg:relative w-72 h-full bg-sidebar-bg border-r border-sidebar-border flex flex-col shadow-lg z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out shrink-0">
        <div class="px-6 py-6 lg:py-8 flex items-center justify-between lg:justify-start gap-4">
            <div class="flex items-center gap-4">
                <div class="h-10 w-10 lg:h-12 lg:w-12 bg-white rounded-xl shadow-sm flex items-center justify-center text-sidebar-accent shrink-0 text-lg lg:text-xl">
                    <i class="fa-regular fa-building"></i>
                </div>
                <div class="flex flex-col justify-center">
                    <h1 class="font-bold text-sidebar-text text-base lg:text-lg leading-tight">Nexus Corp</h1>
                    <span class="text-xs font-mono text-sidebar-muted mt-0.5">SCT-0001</span>
                </div>
            </div>
            <button data-action="toggle-sidebar" class="lg:hidden text-sidebar-muted hover:text-sidebar-dark">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        <div class="px-6 w-full"><hr class="border-sidebar-border border-t"></div>

        <nav class="flex-1 px-4 overflow-y-auto mt-6 custom-scroll">
            <div class="px-2 mb-3">
                <h2 class="text-xs font-bold text-sidebar-muted uppercase tracking-wider">Espaces Sociétés</h2>
            </div>
            <a href="#" data-action="switch-view" data-view="dashboard" id="nav-dashboard" class="nav-item active flex items-center gap-3 px-4 py-3 bg-white text-sidebar-accent rounded-lg shadow-sm border border-sidebar-border/50 font-medium transition-all duration-200 group mb-1">
                <i class="fa-regular fa-chart-bar w-5 text-center"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" data-action="switch-view" data-view="clients" id="nav-clients" class="nav-item flex items-center gap-3 px-4 py-3 text-sidebar-text hover:bg-white/60 hover:text-sidebar-accent rounded-lg font-medium transition-all duration-200 group">
                <i class="fa-regular fa-user group w-5 text-center text-sidebar-muted group-hover:text-sidebar-accent"></i>
                <span>Clients</span>
            </a>
            <a href="#" data-action="switch-view" data-view="contrats" id="nav-contrats" class="nav-item flex items-center gap-3 px-4 py-3 text-sidebar-text hover:bg-white/60 hover:text-sidebar-accent rounded-lg font-medium transition-all duration-200 group">
                <i class="fa-regular fa-file-contract w-5 text-center text-sidebar-muted group-hover:text-sidebar-accent"></i>
                <span>Contrats</span>
            </a>
            <a href="#" data-action="switch-view" data-view="signalements" id="nav-signalements" class="nav-item flex items-center gap-3 px-4 py-3 text-sidebar-text hover:bg-white/60 hover:text-sidebar-accent rounded-lg font-medium transition-all duration-200 group relative">
                <i class="fa-regular fa-bell w-5 text-center text-sidebar-muted group-hover:text-sidebar-accent"></i>
                <span>Signalements</span>
                <span class="absolute right-4 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
            </a>
            <a href="#" data-action="switch-view" data-view="rapports" id="nav-rapports" class="nav-item flex items-center gap-3 px-4 py-3 text-sidebar-text hover:bg-white/60 hover:text-sidebar-accent rounded-lg font-medium transition-all duration-200 group">
                <i class="fa-regular fa-clipboard-list w-5 text-center text-sidebar-muted group-hover:text-sidebar-accent"></i>
                <span>Rapports</span>
            </a>
            <a href="#" data-action="switch-view" data-view="employes" id="nav-employes" class="nav-item flex items-center gap-3 px-4 py-3 text-sidebar-text hover:bg-white/60 hover:text-sidebar-accent rounded-lg font-medium transition-all duration-200 group"><i class="fa-regular fa-address-card w-5 text-center text-sidebar-muted group-hover:text-sidebar-accent"></i><span>Employes</span></a>
        </nav>

        <div class="p-6 mt-auto">
            <button class="w-full flex items-center justify-center gap-2 bg-sidebar-dark text-white hover:bg-[#1a3a48] transition-colors py-3 rounded-full shadow-md group">
                <i class="fa-regular fa-sliders group-hover:rotate-180 transition-transform duration-500"></i>
                <span class="font-medium">Paramètres</span>
            </button>
        </div>
    </aside>

    <!-- ZONE PRINCIPALE -->
    <main class="flex-1 bg-white relative flex flex-col h-full overflow-hidden w-full">
        <header class="h-16 bg-white border-b border-gray-100 flex items-center justify-between px-4 lg:hidden shrink-0 z-10">
            <div class="flex items-center gap-3">
                <button data-action="toggle-sidebar" class="w-10 h-10 flex items-center justify-center text-gray-500 hover:bg-gray-50 rounded-lg"><i class="fa-solid fa-bars text-xl"></i></button>
                <span class="font-bold text-sidebar-text text-lg">Nexus Corp</span>
            </div>
            <div class="h-8 w-8 bg-sidebar-accent text-white rounded-full flex items-center justify-center text-xs font-bold">AD</div>
        </header>

        <div class="flex-1 overflow-y-auto custom-scroll w-full" id="scroll-container">
            
            <!-- VUE DASHBOARD -->
            <div id="view-dashboard" class="p-4 md:p-8 max-w-7xl mx-auto block fade-in">
                 <div class="mb-6 md:mb-8"><div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sidebar-bg border border-sidebar-border text-sidebar-dark font-semibold text-sm tracking-wide shadow-sm"><span class="w-2 h-2 rounded-full bg-sidebar-accent animate-pulse"></span>Dashboard</div></div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-gray-100 flex items-center justify-between hover:border-sidebar-border transition-all group"><div><p class="text-sm font-medium text-gray-400 mb-1">Contrats en cours</p><h3 class="text-3xl font-bold text-sidebar-dark">142</h3></div><div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-xl flex items-center justify-center text-xl group-hover:scale-110 transition-transform"><i class="fa-regular fa-file-lines"></i></div></div>
                    <div class="bg-white p-6 rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-gray-100 flex items-center justify-between hover:border-sidebar-border transition-all group"><div><p class="text-sm font-medium text-gray-400 mb-1">Employés Actifs</p><h3 class="text-3xl font-bold text-sidebar-dark">84</h3></div><div class="w-12 h-12 bg-amber-50 text-amber-500 rounded-xl flex items-center justify-center text-xl group-hover:scale-110 transition-transform"><i class="fa-regular fa-id-card"></i></div></div>
                    <div class="bg-white p-6 rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-gray-100 flex items-center justify-between hover:border-sidebar-border transition-all relative overflow-hidden group"><div class="absolute -right-6 -top-6 w-24 h-24 bg-sidebar-bg rounded-full opacity-50 group-hover:scale-125 transition-transform duration-500"></div><div class="flex-1 flex flex-col justify-between h-full z-10"><div class="mb-4"><p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">CA HT Mensuel</p><p class="text-xl font-bold text-sidebar-accent">125 400 €</p></div><div class="pt-3 border-t border-gray-100"><p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">CA HT Annuel</p><p class="text-xl font-bold text-sidebar-dark">1 450 000 €</p></div></div><div class="z-10 flex flex-col justify-center"><div class="w-10 h-10 bg-green-50 text-green-600 rounded-lg flex items-center justify-center text-lg"><i class="fa-solid fa-euro-sign"></i></div></div></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-gray-100 flex flex-col"><div class="px-6 py-5 border-b border-gray-50 flex justify-between items-center"><div class="flex items-center gap-2"><div class="w-2 h-6 bg-orange-400 rounded-full"></div><h3 class="font-bold text-sidebar-dark text-sm md:text-base">Contrats échéance J-60</h3></div><button class="text-xs text-sidebar-muted hover:text-sidebar-accent transition-colors">Voir tout</button></div><div class="p-0 overflow-x-auto"><table class="w-full text-left text-sm text-gray-600 min-w-[500px]"><thead class="bg-gray-50/50 text-xs uppercase text-gray-400 font-medium"><tr><th class="px-6 py-3">Société</th><th class="px-6 py-3">Référence</th><th class="px-6 py-3">Fin</th><th class="px-6 py-3 text-right">Jours</th></tr></thead><tbody class="divide-y divide-gray-50"><tr class="hover:bg-gray-50/50"><td class="px-6 py-4 font-medium">Alpha Logistics</td><td class="px-6 py-4 font-mono text-xs text-gray-400">CTR-2021-88</td><td class="px-6 py-4">15 Nov 2025</td><td class="px-6 py-4 text-right"><span class="bg-orange-50 text-orange-600 px-2 py-1 rounded text-xs font-bold">42j</span></td></tr><tr class="hover:bg-gray-50/50"><td class="px-6 py-4 font-medium">TechGarden S.A.</td><td class="px-6 py-4 font-mono text-xs text-gray-400">CTR-2022-04</td><td class="px-6 py-4">02 Dec 2025</td><td class="px-6 py-4 text-right"><span class="bg-orange-50 text-orange-600 px-2 py-1 rounded text-xs font-bold">58j</span></td></tr></tbody></table></div></div>
                    <div class="bg-sidebar-bg/30 rounded-2xl border border-sidebar-border/50 p-6 flex flex-col justify-center"><h3 class="font-bold text-sidebar-dark mb-4 flex items-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i> Actions Rapides</h3><div class="space-y-3"><button data-action="open-create-client" class="w-full bg-white hover:bg-sidebar-accent hover:text-white text-sidebar-text py-3 px-4 rounded-xl shadow-sm border border-gray-100 transition-all flex items-center gap-3 text-sm font-medium"><i class="fa-solid fa-plus"></i> Créer un client</button><button data-action="open-create-contract" class="w-full bg-white hover:bg-sidebar-accent hover:text-white text-sidebar-text py-3 px-4 rounded-xl shadow-sm border border-gray-100 transition-all flex items-center gap-3 text-sm font-medium"><i class="fa-regular fa-file-contract"></i> Créer un contrat</button></div></div>
                </div>
                <div data-action="switch-view" data-view="signalements" class="bg-white rounded-2xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-gray-100 overflow-hidden cursor-pointer hover:border-sidebar-accent transition-colors"><div class="px-6 py-5 border-b border-gray-50 flex justify-between items-center bg-red-50/30"><div class="flex items-center gap-2"><div class="w-2 h-6 bg-red-500 rounded-full animate-pulse"></div><h3 class="font-bold text-sidebar-dark">Nouveaux Signalements (QR Code)</h3></div><span class="bg-red-100 text-red-600 py-1 px-3 rounded-full text-xs font-bold">3 nouveaux</span></div><div class="p-6 grid gap-4"><div class="flex items-start gap-4 p-4 rounded-xl border border-gray-100 hover:bg-red-50/20 transition-all"><div class="w-10 h-10 rounded-full bg-red-100 text-red-500 flex items-center justify-center shrink-0 mt-1"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="flex-1"><div class="flex justify-between items-start"><h4 class="font-semibold text-sidebar-dark">Fuite d'eau - Local Technique</h4><span class="text-xs text-gray-400">Il y a 2h</span></div><p class="text-sm text-gray-500 mt-1 line-clamp-1">Signalé via QR Code - Site Alpha Logistics</p></div></div></div></div>
            </div>

            <!-- VUE CLIENTS -->
            <div id="view-clients" class="p-4 md:p-8 max-w-7xl mx-auto hidden fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sidebar-bg border border-sidebar-border text-sidebar-dark font-semibold text-sm tracking-wide shadow-sm"><span class="w-2 h-2 rounded-full bg-sidebar-accent"></span> Gestion des clients</div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button data-action="open-create-societe" class="w-full md:w-auto bg-white border border-sidebar-border text-sidebar-dark hover:bg-sidebar-accent hover:text-white px-5 py-2.5 rounded-xl shadow-lg shadow-sidebar-dark/10 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5"><i class="fa-solid fa-building"></i> <span class="font-medium text-sm">Créer une société</span></button>
                        <button data-action="open-create-client" class="w-full md:w-auto bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-2.5 rounded-xl shadow-lg shadow-sidebar-dark/20 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5"><i class="fa-solid fa-plus"></i> <span class="font-medium text-sm">Créer un client</span></button>
                    </div>
                </div>
                <div class="mb-6 w-full md:max-w-md"><div class="relative"><input type="text" placeholder="Rechercher..." class="w-full bg-white border border-gray-200 text-sm rounded-xl pl-11 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/20 focus:border-sidebar-accent transition-all shadow-sm text-sidebar-text"><i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div>
                <hr class="border-gray-200 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20">
                     <div data-action="open-client-detail" class="bg-white rounded-2xl border border-gray-100 shadow-[0_2px_15px_-3px_rgba(0,0,0,0.05)] hover:shadow-md hover:border-sidebar-border transition-all duration-300 p-6 relative group cursor-pointer active:scale-[0.98]" data-client-id="1">
                        <div class="flex justify-between items-start mb-4"><span data-client-badge class="bg-blue-100 text-badge-direct px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider border border-blue-200">Client Direct</span><div class="flex gap-2 opacity-100 md:opacity-50 group-hover:opacity-100 transition-opacity"><button data-action="edit-client" class="w-8 h-8 rounded-lg hover:bg-gray-100 text-gray-500 hover:text-sidebar-accent flex items-center justify-center"><i class="fa-regular fa-pen-to-square text-sm"></i></button><button data-action="delete-client" class="w-8 h-8 rounded-lg hover:bg-red-50 text-gray-500 hover:text-red-500 flex items-center justify-center"><i class="fa-regular fa-trash-can text-sm"></i></button></div></div>
                        <div class="mb-6"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-xl text-gray-500 mb-3 border border-gray-200"><i class="fa-regular fa-user"></i></div><h3 data-client-name class="text-lg font-bold text-sidebar-dark leading-tight">M. Jean Dupont</h3><p class="text-xs text-gray-400 mt-1 font-mono">CLI-2023-089</p></div>
                        <div class="space-y-3 pt-4 border-t border-gray-50"><div class="flex items-center justify-between group/line"><div class="flex items-center gap-3 overflow-hidden"><i class="fa-regular fa-envelope text-gray-400 text-xs w-4"></i><span data-client-email class="text-sm text-gray-600 truncate">jean.dupont@email.com</span></div><button data-action="copy-text" data-text="jean.dupont@email.com" class="text-gray-300 hover:text-sidebar-accent p-1.5 rounded transition-colors md:opacity-0 group-hover/line:opacity-100"><i class="fa-regular fa-copy text-xs"></i></button></div></div>
                    </div>
                     <div data-action="open-client-detail" class="bg-white rounded-2xl border border-gray-100 shadow-[0_2px_15px_-3px_rgba(0,0,0,0.05)] hover:shadow-md hover:border-sidebar-border transition-all duration-300 p-6 relative group cursor-pointer active:scale-[0.98]" data-client-id="2">
                        <div class="flex justify-between items-start mb-4"><span data-client-badge class="bg-purple-100 text-badge-mandataire px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider border border-purple-200">Mandataire</span><div class="flex gap-2 opacity-100 md:opacity-50 group-hover:opacity-100 transition-opacity"><button data-action="edit-client" class="w-8 h-8 rounded-lg hover:bg-gray-100 text-gray-500 hover:text-sidebar-accent flex items-center justify-center"><i class="fa-regular fa-pen-to-square text-sm"></i></button><button data-action="delete-client" class="w-8 h-8 rounded-lg hover:bg-red-50 text-gray-500 hover:text-red-500 flex items-center justify-center"><i class="fa-regular fa-trash-can text-sm"></i></button></div></div>
                        <div class="mb-6"><div class="w-12 h-12 bg-purple-50 rounded-full flex items-center justify-center text-xl text-badge-mandataire mb-3 border border-purple-100"><i class="fa-solid fa-building"></i></div><h3 data-client-name class="text-lg font-bold text-sidebar-dark leading-tight">Agence Immo 2000</h3><p class="text-xs text-gray-400 mt-1 font-mono">CLI-2023-090</p></div>
                        <div class="space-y-3 pt-4 border-t border-gray-50"><div class="flex items-center justify-between group/line"><div class="flex items-center gap-3 overflow-hidden"><i class="fa-regular fa-envelope text-gray-400 text-xs w-4"></i><span data-client-email class="text-sm text-gray-600 truncate">contact@immo2000.fr</span></div><button data-action="copy-text" data-text="contact@immo2000.fr" class="text-gray-300 hover:text-sidebar-accent p-1.5 rounded transition-colors md:opacity-0 group-hover/line:opacity-100"><i class="fa-regular fa-copy text-xs"></i></button></div></div>
                    </div>
                </div>
            </div>

            <!-- VUE CONTRATS -->
            <div id="view-contrats" class="p-4 md:p-8 max-w-7xl mx-auto hidden fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sidebar-bg border border-sidebar-border text-sidebar-dark font-semibold text-sm tracking-wide shadow-sm"><span class="w-2 h-2 rounded-full bg-sidebar-accent"></span> Gestion des contrats</div>
                    <button data-action="open-create-contract" class="w-full md:w-auto bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-2.5 rounded-xl shadow-lg shadow-sidebar-dark/20 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5"><i class="fa-solid fa-plus"></i> <span class="font-medium text-sm">Créer un contrat</span></button>
                </div>
                <div class="mb-6 w-full md:max-w-md"><div class="relative"><input type="text" placeholder="Rechercher un contrat..." class="w-full bg-white border border-gray-200 text-sm rounded-xl pl-11 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/20 focus:border-sidebar-accent transition-all shadow-sm text-sidebar-text"><i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div>
                <hr class="border-gray-200 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20">\n    <div class="col-span-full bg-white border border-dashed border-sidebar-border rounded-2xl p-6 text-center text-gray-500">Aucune donnée. Connectez Supabase pour afficher les contrats.</div>\n</div>
                        <div class="mb-6"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-xl text-gray-500 mb-3 border border-gray-200"><i class="fa-regular fa-file"></i></div><h3 class="text-lg font-bold text-sidebar-dark leading-tight">Audit Sécurité</h3><p class="text-xs text-gray-400 mt-1 font-mono">CTR-2023-480</p></div>
                        <div class="space-y-3 pt-4 border-t border-gray-50"><div class="flex items-center gap-3"><i class="fa-regular fa-user text-gray-400 text-xs w-4"></i><span class="text-sm text-gray-600">M. Jean Dupont</span></div><div class="flex items-center gap-3"><i class="fa-regular fa-calendar text-gray-400 text-xs w-4"></i><span class="text-sm text-gray-600">Début: 01/11/2023</span></div></div>
                    </div>
                </div>
            </div>

            <!-- VUE SIGNALEMENTS -->
            <div id="view-signalements" class="h-full hidden fade-in flex flex-col md:flex-row overflow-hidden">
                <!-- LISTE GAUCHE -->
                <div class="w-full md:w-1/3 bg-white border-r border-gray-100 flex flex-col h-full z-10" id="signalements-list-panel">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex justify-between items-center mb-4"><h2 class="text-lg font-bold text-sidebar-dark">Signalements</h2><span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded-full">3 Nouveaux</span></div>
                        <div class="flex gap-2"><button class="px-3 py-1.5 rounded-lg text-xs font-medium bg-sidebar-dark text-white">Tous</button><button class="px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-500 hover:bg-gray-200">En cours</button><button class="px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-500 hover:bg-gray-200">Résolus</button></div>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scroll p-2 space-y-1">
                        <div id="report-item-1" data-action="open-report" data-id="1" class="report-item p-4 rounded-xl border border-transparent cursor-pointer hover:bg-gray-50 transition-colors relative">
                            <div class="flex justify-between items-start mb-1"><span class="bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded border border-red-200">Nouveau</span><span class="text-xs text-gray-400">14:30</span></div>
                            <h4 class="font-bold text-sidebar-dark text-sm mb-1">Fuite d'eau - Local Technique</h4><p class="text-xs text-gray-500 line-clamp-1"><i class="fa-solid fa-qrcode text-gray-300 mr-1"></i> Scan QR Code - Site Alpha</p>
                        </div>
                        <div id="report-item-2" data-action="open-report" data-id="2" class="report-item p-4 rounded-xl border border-transparent hover:bg-gray-50 cursor-pointer transition-colors">
                            <div class="flex justify-between items-start mb-1"><span class="bg-orange-100 text-orange-600 text-[10px] font-bold px-2 py-0.5 rounded border border-orange-200">En cours</span><span class="text-xs text-gray-400">Hier</span></div>
                            <h4 class="font-bold text-sidebar-dark text-sm mb-1">Porte Garage Bloquée</h4><p class="text-xs text-gray-500 line-clamp-1"><i class="fa-solid fa-qrcode text-gray-300 mr-1"></i> Scan QR Code - Résidence Lilas</p>
                        </div>
                        <div id="report-item-3" data-action="open-report" data-id="3" class="report-item p-4 rounded-xl border border-transparent hover:bg-gray-50 cursor-pointer transition-colors opacity-70">
                            <div class="flex justify-between items-start mb-1"><span class="bg-green-100 text-green-600 text-[10px] font-bold px-2 py-0.5 rounded border border-green-200">Résolu</span><span class="text-xs text-gray-400">24 Oct</span></div>
                            <h4 class="font-bold text-sidebar-dark text-sm mb-1">Lumière Hall HS</h4><p class="text-xs text-gray-500 line-clamp-1"><i class="fa-solid fa-qrcode text-gray-300 mr-1"></i> Scan QR Code - Site Alpha</p>
                        </div>
                    </div>
                </div>
                <!-- DETAIL DROITE -->
                <div class="w-full md:w-2/3 bg-gray-50/50 flex flex-col h-full transform translate-x-full md:translate-x-0 transition-transform absolute md:relative z-20" id="signalements-detail-panel">
                    <div class="md:hidden p-4 bg-white border-b border-gray-100 flex items-center gap-2"><button data-action="close-report-details" class="text-gray-500 hover:text-sidebar-dark"><i class="fa-solid fa-arrow-left"></i> Retour</button></div>
                    <div class="bg-white px-6 pt-6 pb-2 border-b border-gray-100 shadow-sm shrink-0">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                            <div><div class="flex items-center gap-3 mb-2"><h2 class="text-xl font-bold text-sidebar-dark" id="r-detail-title">Sélectionnez un signalement</h2><span id="r-detail-badge" class="hidden text-xs font-bold px-2 py-1 rounded-full">Statut</span></div><p class="text-sm text-gray-500 flex items-center gap-4" id="r-detail-meta"></p></div>
                            <div class="flex items-center gap-3 w-full md:w-auto">
                                <div class="relative w-full md:w-48">
                                    <select id="report-status-select" class="hidden w-full appearance-none bg-white border border-gray-300 hover:border-sidebar-accent text-sidebar-dark text-sm rounded-lg focus:ring-sidebar-accent focus:border-sidebar-accent block p-2.5 pr-8 font-medium shadow-sm transition-colors cursor-pointer"><option value="Nouveau" disabled>Nouveau</option><option value="Prise en charge">Prise en charge</option><option value="En cours">En cours de résolution</option><option value="Résolu">Résolu</option></select>
                                    <div id="report-status-icon" class="hidden pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500"><i class="fa-solid fa-chevron-down text-xs"></i></div>
                                </div>
                                <button id="btn-send-report" data-action="send-report" class="hidden bg-green-600 hover:bg-green-500 text-white px-4 py-2.5 rounded-lg text-sm font-medium transition-colors animate-fade-in shadow-sm whitespace-nowrap"><i class="fa-regular fa-paper-plane mr-2"></i> Compte-rendu</button>
                            </div>
                        </div>
                        <div id="r-detail-content" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 pt-4 pb-4 border-t border-gray-100">
                            <div class="col-span-1">
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Déclarant (Occupant)</p>
                                <div class="flex items-start gap-3"><div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center shrink-0"><i class="fa-regular fa-user"></i></div><div><p class="text-sm font-bold text-sidebar-dark" id="r-reporter-name">-</p><p class="text-xs text-gray-500 mb-1" id="r-reporter-phone">-</p><button data-action="copy-text" class="text-[10px] font-medium text-sidebar-accent hover:underline flex items-center gap-1"><i class="fa-regular fa-copy"></i> Copier</button></div></div>
                            </div>
                            <div class="col-span-1 md:col-span-2">
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Description du problème</p>
                                <div class="bg-gray-50 p-3 rounded-lg border border-gray-100"><p class="text-sm text-gray-700 leading-relaxed mb-3" id="r-description">-</p><div class="flex gap-2 overflow-x-auto" id="r-photos-container"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scroll p-8 relative">
                        <div class="max-w-3xl mx-auto timeline-line relative pl-6 pb-10" id="timeline-container"></div>
                    </div>
                    <div class="bg-white p-4 border-t border-gray-100 shrink-0">
                        <div class="flex gap-4 max-w-3xl mx-auto"><div class="flex-1 relative"><input type="text" id="comment-input" placeholder="Ajouter un commentaire ou une note de suivi..." class="w-full bg-gray-50 border border-gray-200 rounded-xl pl-4 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent focus:border-sidebar-accent transition-all"><button class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-2"><i class="fa-solid fa-paperclip"></i></button></div><button data-action="add-comment" class="bg-sidebar-bg hover:bg-sidebar-border text-sidebar-dark px-6 py-3 rounded-xl font-bold transition-colors shadow-sm"><i class="fa-regular fa-paper-plane"></i></button></div>
                    </div>
                </div>
            </div>

            <!-- VUE RAPPORTS -->
            <div id="view-rapports" class="p-4 md:p-8 max-w-7xl mx-auto hidden fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sidebar-bg border border-sidebar-border text-sidebar-dark font-semibold text-sm tracking-wide shadow-sm"><span class="w-2 h-2 rounded-full bg-sidebar-accent"></span> Gestion des Rapports</div>
                    <button data-action="open-create-report" class="w-full md:w-auto bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-2.5 rounded-xl shadow-lg shadow-sidebar-dark/20 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5"><i class="fa-solid fa-plus"></i> <span class="font-medium text-sm">Créer un rapport</span></button>
                </div>
                <div class="mb-6 w-full md:max-w-md"><div class="relative"><input type="text" placeholder="Rechercher un rapport..." class="w-full bg-white border border-gray-200 text-sm rounded-xl pl-11 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/20 focus:border-sidebar-accent transition-all shadow-sm text-sidebar-text"><i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div>
                <hr class="border-gray-200 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20" id="rapports-grid">
    <div class="col-span-full bg-white border border-dashed border-sidebar-border rounded-2xl p-6 text-center text-gray-500">Aucun rapport. Connectez Supabase pour afficher l'historique.</div>
</div>
            </div>
            </div>

            <!-- VUE EMPLOYES -->
            <div id="view-employes" class="p-4 md:p-8 max-w-7xl mx-auto hidden fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sidebar-bg border border-sidebar-border text-sidebar-dark font-semibold text-sm tracking-wide shadow-sm"><span class="w-2 h-2 rounded-full bg-sidebar-accent"></span> Gestion des Employes</div>
                    <button data-action="open-create-employee" class="w-full md:w-auto bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-2.5 rounded-xl shadow-lg shadow-sidebar-dark/20 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5"><i class="fa-solid fa-plus"></i> <span class="font-medium text-sm">Creer un employe</span></button>
                </div>
                <div class="mb-6 w-full md:max-w-md">
                    <div class="relative">
                        <input type="text" placeholder="Rechercher un employe..." class="w-full bg-white border border-gray-200 text-sm rounded-xl pl-11 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/20 focus:border-sidebar-accent transition-all shadow-sm text-sidebar-text">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                <hr class="border-gray-200 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20" id="employes-grid">\n    <div class="col-span-full bg-white border border-dashed border-sidebar-border rounded-2xl p-6 text-center text-gray-500">Aucun employe. Connectez Supabase pour alimenter la liste.</div>\n</div>
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-lg">TM</div>
                            <div>
                                <h3 class="text-lg font-bold text-sidebar-dark leading-tight">Thomas Martin</h3>
                                <p class="text-xs text-gray-500">thomas.martin@nexus.com</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><i class="fa-regular fa-phone mr-2 text-gray-400"></i>06 11 22 33 44</p>
                            <p><i class="fa-regular fa-building mr-2 text-gray-400"></i>Site Alpha Logistics</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- MODAL CREATION RAPPORT -->
    <div id="create-report-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
         <div id="report-modal-backdrop" data-action="close-create-report" class="absolute inset-0 bg-gray-900/30 backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>
         <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full md:w-3/4 lg:w-[80%]">
            <div id="report-modal-panel" class="pointer-events-auto w-full transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                <div class="bg-sidebar-bg px-4 md:px-8 py-6 border-b border-sidebar-border flex justify-between items-center shrink-0">
                    <div><h2 class="text-xl md:text-2xl font-bold text-sidebar-dark">Nouveau Rapport</h2><p class="text-sidebar-muted text-sm mt-1">Compte-rendu d'intervention</p></div>
                    <button data-action="close-create-report" class="text-gray-400 hover:text-gray-600 transition-colors p-2"><i class="fa-solid fa-xmark text-2xl"></i></button>
                </div>
                <div class="px-4 md:px-8 py-6 bg-white border-b border-gray-100 shrink-0">
                    <div class="flex items-center w-full">
                        <div class="flex flex-col items-center relative z-10"><div id="r-step-dot-1" class="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-sm md:text-base text-white bg-sidebar-accent transition-colors duration-300">1</div><span class="text-[10px] md:text-xs font-medium text-sidebar-text mt-2">Infos</span></div>
                        <div class="flex-1 h-1 bg-gray-200 mx-2 rounded relative"><div id="r-progress-1" class="absolute top-0 left-0 h-full bg-sidebar-accent rounded transition-all duration-300 w-0"></div></div>
                        <div class="flex flex-col items-center relative z-10"><div id="r-step-dot-2" class="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-sm md:text-base text-gray-400 bg-gray-200 transition-colors duration-300">2</div><span class="text-[10px] md:text-xs font-medium text-gray-400 mt-2">Contenu</span></div>
                        <div class="flex-1 h-1 bg-gray-200 mx-2 rounded relative"><div id="r-progress-2" class="absolute top-0 left-0 h-full bg-sidebar-accent rounded transition-all duration-300 w-0"></div></div>
                        <div class="flex flex-col items-center relative z-10"><div id="r-step-dot-3" class="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-sm md:text-base text-gray-400 bg-gray-200 transition-colors duration-300">3</div><span class="text-[10px] md:text-xs font-medium text-gray-400 mt-2">Signature</span></div>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto custom-scroll bg-gray-50/50">
                    <div class="max-w-4xl mx-auto p-4 md:p-8">
                                                <!-- Step 1 -->
                        <div id="r-step-content-1">
                            <h3 class="text-lg font-bold text-sidebar-dark mb-6">Informations générales</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                    <label for="report-contract-select" class="block text-sm font-medium text-gray-700 mb-2">Site / Contrat</label>
                                    <div class="relative">
                                        <select id="report-contract-select" class="w-full bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-sidebar-accent focus:border-sidebar-accent block py-3 px-4 appearance-none shadow-sm">
                                            <option value="">Choisir un site...</option>
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400"><i class="fa-solid fa-chevron-down text-xs"></i></span>
                                    </div>
                                </div>
                                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Date et Heure</label>
                                    <div class="flex gap-2">
                                        <input type="date" id="report-date" class="w-full bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-sidebar-accent focus:border-sidebar-accent block py-3 px-3 shadow-sm">
                                        <input type="time" id="report-start-time" class="bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-sidebar-accent focus:border-sidebar-accent block py-3 px-3 w-28 shadow-sm">
                                    </div>
                                </div>
                                <div class="md:col-span-2 bg-white p-6 rounded-2xl border border-gray-100 shadow-sm space-y-3">
                                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                        <div>
                                            <p class="block text-sm font-medium text-gray-700">Personnes présentes sur site</p>
                                            <p class="text-xs text-gray-400">Ajoutez les collaborateurs concernés</p>
                                        </div>
                                        <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                                            <select id="report-attendee-select" class="flex-1 bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-sidebar-accent focus:border-sidebar-accent py-2.5 px-3 shadow-sm">
                                                <option value="">Choisir une personne...</option>
                                            </select>
                                            <button data-action="add-report-attendee" class="whitespace-nowrap bg-sidebar-dark text-white px-4 py-2.5 rounded-xl text-sm font-medium hover:bg-sidebar-accent transition-colors shadow-sm"><i class="fa-solid fa-plus mr-2"></i>Ajouter</button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-3">
                                        <input id="report-attendee-name" type="text" placeholder="Nom et prénom (manuel)" class="bg-gray-50 border border-gray-200 text-sm rounded-xl px-3 py-2.5 focus:ring-sidebar-accent focus:border-sidebar-accent md:col-span-2">
                                        <input id="report-attendee-role" type="text" placeholder="Rôle / fonction" class="bg-gray-50 border border-gray-200 text-sm rounded-xl px-3 py-2.5 focus:ring-sidebar-accent focus:border-sidebar-accent">
                                        <div class="md:col-span-3 flex justify-end">
                                            <button data-action="add-report-attendee-manual" class="text-sm font-medium text-sidebar-accent hover:text-sidebar-dark flex items-center gap-2 px-3 py-2"> <i class="fa-solid fa-user-plus"></i> Ajouter manuellement</button>
                                        </div>
                                    </div>
                                    <div id="report-attendees-container" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Step 2 -->
                        <div id="r-step-content-2" class="hidden">
                            <h3 class="text-lg font-bold text-sidebar-dark mb-6">Contenu du rapport</h3>
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm mb-6">
                                <h4 class="font-bold text-sidebar-dark mb-4">Ajouter une section</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="section-title" class="text-sm font-medium text-gray-700">Titre de la section</label>
                                        <input type="text" id="section-title" placeholder="Ex: Vérification VMC" class="mt-1 w-full bg-gray-50 border border-gray-300 text-sm rounded-lg p-2.5 focus:ring-sidebar-accent focus:border-sidebar-accent">
                                    </div>
                                    <div>
                                        <label for="section-action" class="text-sm font-medium text-gray-700">Action corrective</label>
                                        <input type="text" id="section-action" placeholder="Ex: Changement filtre" class="mt-1 w-full bg-gray-50 border border-gray-300 text-sm rounded-lg p-2.5 focus:ring-sidebar-accent focus:border-sidebar-accent">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="section-desc" class="text-sm font-medium text-gray-700">Description / Remarques</label>
                                        <textarea id="section-desc" rows="3" placeholder="RAS, fonctionnement normal..." class="mt-1 w-full bg-gray-50 border border-gray-300 text-sm rounded-lg p-2.5 focus:ring-sidebar-accent focus:border-sidebar-accent"></textarea>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="text-sm font-medium text-gray-700">Photos</label>
                                        <div class="mt-1 flex items-center gap-4">
                                            <button data-action="trigger-section-photo-picker" class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium"><i class="fa-solid fa-camera mr-2"></i> Choisir...</button>
                                            <div id="section-photos-preview" class="flex gap-2 items-center flex-wrap"></div>
                                            <input type="file" id="section-photos-input" multiple class="hidden">
                                        </div>
                                    </div>
                                    <div class="md:col-span-2 text-right">
                                        <button data-action="add-report-section" class="bg-sidebar-dark hover:bg-sidebar-accent text-white font-medium px-5 py-2 rounded-lg shadow-sm transition-colors">Ajouter la section</button>
                                    </div>
                                </div>
                            </div>
                            <div id="report-sections-list" class="space-y-4"></div>
                        </div>
                        <!-- Step 3 -->
                        <div id="r-step-content-3" class="hidden">
                            <h3 class="text-lg font-bold text-sidebar-dark mb-6">Signatures</h3>
                            <div id="signatures-list" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white px-4 md:px-8 py-4 border-t border-gray-100 flex justify-between items-center shrink-0">
                    <button id="r-btn-prev" data-action="report-prev-step" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2.5 rounded-lg font-medium transition-colors hidden">Précédent</button>
                    <button id="r-btn-next" data-action="report-next-step" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-sm">Suivant</button>
                    <div id="r-btn-actions" class="hidden flex items-center gap-3">
                        <button data-action="generate-pdf" class="text-sm font-medium text-sidebar-accent hover:underline">Aperçu PDF</button>
                        <button data-action="finish-report" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-sm">Finaliser et envoyer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SIGNATURE CANVAS MODAL -->
    <div id="signature-pad-modal" class="fixed inset-0 z-[60] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
         <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
             <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                 <h3 class="font-bold text-lg text-sidebar-dark">Signature : <span id="sig-pad-name" class="text-sidebar-accent">Nom</span></h3>
                 <button data-action="close-signature-pad" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
             </div>
             <div class="p-6 bg-gray-50 flex justify-center">
                 <canvas id="signature-canvas" width="400" height="200" class="bg-white border-2 border-dashed border-gray-300 rounded-xl cursor-crosshair shadow-inner touch-none"></canvas>
             </div>
             <div class="px-6 py-4 border-t border-gray-100 flex justify-between">
                 <button data-action="clear-signature" class="text-sm text-red-500 hover:text-red-700 font-medium">Effacer</button>
                 <button data-action="save-signature" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-6 py-2 rounded-lg font-medium transition-colors">Valider</button>
             </div>
         </div>
    </div>

    <!-- MODAL DETAILS CONTRACT -->
    <div id="details-contract-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
        <div id="details-contract-backdrop" data-action="close-contract-details" class="absolute inset-0 bg-gray-900/30 backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full md:w-3/4">
            <div id="details-contract-panel" class="pointer-events-auto w-full transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                <div class="bg-white px-4 md:px-8 py-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start gap-4 shrink-0">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-gray-50 rounded-2xl flex items-center justify-center text-3xl text-gray-400 border border-gray-100 shrink-0"><i class="fa-regular fa-file-lines"></i></div>
                        <div><h2 class="text-xl font-bold text-sidebar-dark leading-tight" id="dc-name">-</h2><p class="text-gray-400 font-mono text-sm" id="dc-ref">-</p></div>
                    </div>
                    <div class="flex gap-2">
                        <button data-action="open-contract-edit" class="bg-sidebar-accent hover:bg-sidebar-dark text-white px-3 py-2 rounded-full text-xs font-medium shadow-sm transition-colors">Modifier le contrat</button>
                        <button data-action="close-contract-details" class="text-gray-400 hover:text-gray-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto bg-gray-50/50 p-4 md:p-8 custom-scroll">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col items-center text-center"><div class="flex items-center gap-2 mb-2"><span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-regular fa-clock"></i></span><h4 class="font-bold text-sidebar-dark">Pointage Société</h4></div><p class="text-xs text-gray-500 mb-6">Pour l'arrivée et le départ des employés</p><img id="qr-pointage" src="" class="w-40 h-40 mb-6 border border-gray-100 rounded-lg p-2" alt="QR Pointage"><button data-action="print-qr" data-target="pointage" class="text-sm font-medium text-sidebar-accent hover:text-sidebar-dark border border-sidebar-accent hover:bg-sidebar-bg px-4 py-2 rounded-lg transition-colors w-full"><i class="fa-solid fa-print mr-2"></i> Imprimer</button></div>
                        <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col items-center text-center"><div class="flex items-center gap-2 mb-2"><span class="bg-red-100 text-red-600 w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-bullhorn"></i></span><h4 class="font-bold text-sidebar-dark">Signalement Occupants</h4></div><p class="text-xs text-gray-500 mb-6">Pour déclarer un incident sur site</p><img id="qr-signalement" src="" class="w-40 h-40 mb-6 border border-gray-100 rounded-lg p-2" alt="QR Signalement"><button data-action="print-qr" data-target="signalement" class="text-sm font-medium text-sidebar-accent hover:text-sidebar-dark border border-sidebar-accent hover:bg-sidebar-bg px-4 py-2 rounded-lg transition-colors w-full"><i class="fa-solid fa-print mr-2"></i> Imprimer</button></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8"><div class="flex justify-between items-center mb-6"><h3 class="font-bold text-sidebar-dark flex items-center gap-2"><i class="fa-solid fa-user-shield text-gray-400"></i> Personnel sur Site</h3><button data-action="open-change-employee" class="text-xs font-medium bg-sidebar-bg text-sidebar-accent hover:bg-sidebar-border px-3 py-1.5 rounded-lg transition-colors"><i class="fa-solid fa-user-pen mr-1"></i> Modifier l'affectation</button></div><div class="flex items-center gap-4 p-4 border border-gray-100 rounded-xl bg-gray-50/50" id="assigned-employee-card"><!-- Injected JS --></div></div>
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8"><div class="flex justify-between items-center mb-6"><h3 class="font-bold text-sidebar-dark flex items-center gap-2"><i class="fa-solid fa-folder-open text-gray-400"></i> Documents Contractuels</h3><button class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors shadow-sm"><i class="fa-solid fa-plus mr-1"></i> Ajouter un document</button></div><div class="space-y-3" id="contract-docs-list"><!-- Injected JS --></div></div>
                    
                    <!-- NOUVEAU : RAPPORTS D'INTERVENTION ARCHIVES -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                         <div class="px-6 py-4 border-b border-gray-50 bg-gray-50/30 flex justify-between items-center">
                            <h3 class="font-bold text-sidebar-dark flex items-center gap-2">
                                <i class="fa-solid fa-clipboard-list text-gray-400"></i> Historique des Rapports
                            </h3>
                            <span class="text-[10px] text-gray-400 font-medium bg-gray-100 px-2 py-1 rounded">Archivage: 1 an</span>
                        </div>
                        <div id="contract-intervention-reports" class="p-0">
                            <!-- Injected JS -->
                        </div>
                    </div>

                    <!-- SIGNALEMENTS ARCHIVES -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                        <div class="px-6 py-4 border-b border-gray-50 bg-gray-50/30 flex justify-between items-center"><h3 class="font-bold text-sidebar-dark flex items-center gap-2"><i class="fa-solid fa-box-archive text-gray-400"></i> Signalements Archivés</h3><span class="text-[10px] text-gray-400 font-medium bg-gray-100 px-2 py-1 rounded">Archivage: 1 an</span></div>
                        <div id="contract-archived-reports" class="p-0"><!-- Injected JS --></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
                <!-- MODAL CREATE CLIENT -->
      <div id="create-client-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
          <div data-action="close-create-client" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
          <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
              <div class="pointer-events-auto w-full md:w-[92%] lg:w-[75%] max-w-[1120px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-3xl overflow-hidden">
                  <div class="px-8 py-6 border-b border-gray-100 flex items-start justify-between gap-4">
                      <div>
                          <p class="text-xs uppercase tracking-widest text-sidebar-muted">Creation guidee</p>
                          <h2 class="text-2xl md:text-3xl font-bold text-sidebar-dark leading-tight">Creer un Client</h2>
                      </div>
                      <button data-action="close-create-client" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                          <i class="fa-solid fa-xmark text-2xl"></i>
                      </button>
                  </div>
                    <div class="bg-gray-50 px-8 py-4 border-b border-gray-100 step-track">
                        <div class="grid grid-cols-3 gap-5 text-xs">
                            <div class="flex items-center gap-3">
                                <div id="step-dot-1" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-sidebar-accent text-white font-semibold flex items-center justify-center text-sm">1</div>
                                <div>
                                    <p class="step-label step-label-muted text-xs uppercase tracking-wider">Etape 1</p>
                                    <p class="step-label text-sm font-semibold text-sidebar-dark">Choisir le type</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div id="step-dot-2" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-gray-200 text-gray-500 font-semibold flex items-center justify-center text-sm">2</div>
                                <div>
                                    <p class="step-label step-label-muted text-xs uppercase tracking-wider">Etape 2</p>
                                    <p class="step-label text-sm font-semibold text-sidebar-dark">Renseignements</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div id="step-dot-3" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-gray-200 text-gray-500 font-semibold flex items-center justify-center text-sm">3</div>
                                <div>
                                    <p class="step-label step-label-muted text-xs uppercase tracking-wider">Etape 3</p>
                                    <p class="step-label text-sm font-semibold text-sidebar-dark">Resume</p>
                                </div>
                            </div>
                        </div>
                        <div class="step-progress-track mt-4 h-1 overflow-hidden">
                            <span id="step-progress-fill" class="step-progress-fill block"></span>
                        </div>
                    </div>
                  <div class="flex-1 overflow-y-auto px-8 py-6 space-y-10">
                      <div id="step-content-1" class="space-y-6">
                          <p class="text-sm text-gray-500 max-w-2xl">Definissez d'abord s'il s'agit d'un client direct ou d'un mandataire. Chaque carte mettra en avant le formulaire adapte.</p>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <button type="button" data-action="select-client-type" data-client-type="direct" data-client-card="direct" class="border border-gray-200 rounded-3xl p-6 text-left transition-all duration-200 hover:shadow-[0_10px_45px_rgba(15,23,42,0.15)] hover:border-sidebar-accent bg-white flex flex-col gap-4 shadow-sm">
                                  <div class="flex items-center justify-between">
                                      <div>
                                          <h3 class="text-lg font-semibold text-sidebar-dark">Client direct</h3>
                                          <p class="text-sm text-gray-400">Relation directe avec votre client final.</p>
                                      </div>
                                      <span class="text-sidebar-accent text-3xl font-bold">&rarr;</span>
                                  </div>
                                  <p class="text-sm text-gray-500">Ajoutez logo, nom, adresse et coordonnees.</p>
                                  <span class="self-end text-[11px] font-semibold uppercase text-sidebar-accent tracking-[0.3em]">Selectionner</span>
                              </button>
                              <button type="button" data-action="select-client-type" data-client-type="mandataire" data-client-card="mandataire" class="border border-gray-200 rounded-3xl p-6 text-left transition-all duration-200 hover:shadow-[0_10px_45px_rgba(15,23,42,0.15)] hover:border-sidebar-accent bg-white flex flex-col gap-4 shadow-sm">
                                  <div class="flex items-center justify-between">
                                      <div>
                                          <h3 class="text-lg font-semibold text-sidebar-dark">Mandataire</h3>
                                          <p class="text-sm text-gray-400">Mandataire, agence ou representant intermediaire.</p>
                                      </div>
                                      <span class="text-sidebar-accent text-3xl font-bold">&rarr;</span>
                                  </div>
                                  <p class="text-sm text-gray-500">Renseignez l'entite, puis le gestionnaire de contact.</p>
                                  <span class="self-end text-[11px] font-semibold uppercase text-sidebar-accent tracking-[0.3em]">Selectionner</span>
                              </button>
                          </div>
                      </div>
                        <div id="step-content-2" class="hidden space-y-6">
                           <div class="space-y-4">
                               <div id="client-direct-panel" class="hidden rounded-3xl border border-gray-100 bg-white shadow-sm p-6 space-y-5">
                                   <div class="flex items-center justify-between">
                                       <h4 class="text-xs uppercase tracking-[0.4em] text-gray-400 font-semibold">Client direct</h4>
                                   </div>
                                   <div id="form-direct" class="space-y-6">
                                       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Logo du client
                                               <input type="file" id="client-direct-logo" accept="image/png, image/jpeg" class="mt-2 bg-white border border-dashed border-gray-200 rounded-xl p-3 text-xs text-gray-500 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/50"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Nom*
                                               <input type="text" id="client-direct-lastname" placeholder="Dupont" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Prenom*
                                               <input type="text" id="client-direct-firstname" placeholder="Jean" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Adresse postale complete*
                                               <input type="text" id="client-direct-address" data-address-input class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : 45 Rue du Port, 75002 Paris"/>
                                           </label>
                                       </div>
                                       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Email*
                                               <input type="email" id="client-direct-email" placeholder="jean.dupont@email.com" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Telephone*
                                               <input type="tel" id="client-direct-phone" placeholder="06 12 34 56 78" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                       </div>
                                   </div>
                               </div>
                               <div id="client-mandataire-panel" class="hidden rounded-3xl border border-gray-100 bg-white shadow-sm p-6 space-y-5">
                                   <div class="flex items-center justify-between">
                                        <h4 class="text-xs uppercase tracking-[0.4em] text-gray-400 font-semibold">Mandataire</h4>
                                    </div>
                                   <div id="form-mandataire" class="space-y-6">
                                       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Logo du mandataire
                                               <input type="file" id="client-mand-logo" accept="image/png, image/jpeg" class="mt-2 bg-white border border-dashed border-gray-200 rounded-xl p-3 text-xs text-gray-500 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/50"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Societe / representant*
                                               <input type="text" id="client-mand-company" placeholder="Agence Immo 2000" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                       </div>
                                       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Adresse postale complete*
                                               <input type="text" id="client-mand-address" data-address-input class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : 120 Rue de la Republique, Lyon"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Email*
                                               <input type="email" id="client-mand-email" placeholder="contact@immo2000.fr" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                           <label class="flex flex-col text-sm font-medium text-gray-600">
                                               Telephone*
                                               <input type="tel" id="client-mand-phone" placeholder="04 78 56 32 10" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                           </label>
                                       </div>
                                       <div class="border border-dashed border-sidebar-border/80 rounded-2xl bg-white p-5 space-y-4">
                                           <div class="flex items-center justify-between">
                                               <p class="text-sm font-semibold text-sidebar-dark">Coordonnees de contact (gestionnaire)</p>
                                               <span class="text-xs text-sidebar-accent font-semibold uppercase tracking-[0.3em]">Gestionnaire</span>
                                           </div>
                                           <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                               <label class="flex flex-col text-sm font-medium text-gray-600">
                                                   Prenom
                                                   <input type="text" id="client-mand-contact-firstname" placeholder="Julie" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                               </label>
                                               <label class="flex flex-col text-sm font-medium text-gray-600">
                                                   Nom
                                                   <input type="text" id="client-mand-contact-lastname" placeholder="Dubois" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                               </label>
                                           </div>
                                           <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                               <label class="flex flex-col text-sm font-medium text-gray-600">
                                                   Email direct
                                                   <input type="email" id="client-mand-contact-email" placeholder="julie.dubois@immo2000.fr" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                               </label>
                                               <label class="flex flex-col text-sm font-medium text-gray-600">
                                                   Ligne directe
                                                   <input type="tel" id="client-mand-contact-phone" placeholder="06 22 44 66 88" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent"/>
                                               </label>
                                           </div>
                                       </div>
                                   </div>
                               </div>
                           </div>
                       </div>
                      <div id="step-content-3" class="hidden space-y-6">
                          <p class="text-sm text-gray-500 max-w-2xl">Verifiez les informations avant la validation finale. Vous pouvez retourner et modifier les details si besoin.</p>
                          <div id="recap-direct" class="hidden border border-gray-100 rounded-3xl bg-white shadow-sm p-6 space-y-4">
                              <h3 class="text-lg font-semibold text-sidebar-dark">Resume Client direct</h3>
                              <div class="grid grid-cols-2 gap-4 text-sm text-gray-500">
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Nom complet</p>
                                      <p id="recap-direct-name" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Adresse</p>
                                      <p id="recap-direct-address" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Email</p>
                                      <p id="recap-direct-email" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Telephone</p>
                                      <p id="recap-direct-phone" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                              </div>
                          </div>
                          <div id="recap-mandataire" class="hidden border border-gray-100 rounded-3xl bg-white shadow-sm p-6 space-y-4">
                              <h3 class="text-lg font-semibold text-sidebar-dark">Resume Mandataire</h3>
                              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500">
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Societe / representant</p>
                                      <p id="recap-mand-company" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Adresse</p>
                                      <p id="recap-mand-address" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Email</p>
                                      <p id="recap-mand-email" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                                  <div>
                                      <p class="text-xs uppercase tracking-wider text-gray-400">Telephone</p>
                                      <p id="recap-mand-phone" class="text-sidebar-dark font-semibold">-</p>
                                  </div>
                              </div>
                              <div class="border-t border-gray-100 pt-4 text-sm space-y-2">
                                  <p class="text-xs uppercase tracking-wider text-gray-400">Gestionnaire contact</p>
                                  <p class="text-sidebar-dark font-semibold" id="recap-mand-contact-name">-</p>
                                  <p class="text-sm text-gray-500" id="recap-mand-contact-email">-</p>
                                  <p class="text-sm text-gray-500" id="recap-mand-contact-phone">-</p>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="px-8 py-5 border-t border-gray-100 bg-white flex flex-wrap gap-3 items-center justify-between">
                      <button id="btn-prev" data-action="prev-step" type="button" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-3 rounded-xl font-medium transition-colors hidden">Precedent</button>
                      <div class="flex items-center gap-3 ml-auto">
                          <button id="btn-next" data-action="next-step" type="button" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors hidden">Suivant</button>
                          <button id="btn-finish" data-action="finish-creation" type="button" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-medium transition-colors hidden">Terminer</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
      <!-- MODAL CLIENT DETAIL -->
      <div id="client-detail-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="client-detail-title" role="dialog" aria-modal="true">
          <div data-action="close-client-detail" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
          <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
              <div class="pointer-events-auto w-full md:w-[92%] lg:w-[70%] max-w-[1100px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                  <div class="px-8 py-6 border-b border-gray-100 flex justify-between items-start gap-4">
                      <div>
                          <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Fiche client</p>
                          <h2 id="detail-client-name" class="text-2xl font-bold text-sidebar-dark">-</h2>
                          <p id="detail-client-ref" class="text-sm text-gray-500 mt-1 font-mono">-</p>
                      </div>
                      <button data-action="close-client-detail" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                          <i class="fa-solid fa-xmark text-2xl"></i>
                      </button>
                  </div>
                  <div class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
                      <div class="flex flex-col gap-6">
                          <div class="flex items-center gap-5 bg-gray-50 border border-sidebar-border rounded-3xl p-5">
                              <div class="w-16 h-16 rounded-2xl border border-sidebar-border overflow-hidden bg-white flex items-center justify-center">
                                  <img id="detail-client-logo" src="" alt="Logo client" class="w-full h-full object-cover">
                              </div>
                              <div class="space-y-1">
                                  <p id="detail-client-type" class="text-xs uppercase tracking-[0.4em] text-sidebar-accent font-semibold">-</p>
                                  <p id="detail-client-address" class="text-sm text-gray-600">-</p>
                              </div>
                          </div>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div class="bg-white border border-gray-100 rounded-3xl p-5 space-y-2">
                                  <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Contact principal</p>
                                  <p id="detail-client-email" class="text-sm text-sidebar-dark font-semibold">-</p>
                                  <p id="detail-client-phone" class="text-sm text-gray-500">-</p>
                              </div>
                              <div id="detail-manager-block" class="bg-white border border-gray-100 rounded-3xl p-5 space-y-2 hidden">
                                  <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Gestionnaire</p>
                                  <p id="detail-manager-name" class="text-sm text-sidebar-dark font-semibold">-</p>
                                  <p id="detail-manager-email" class="text-sm text-gray-500">-</p>
                                  <p id="detail-manager-phone" class="text-sm text-gray-500">-</p>
                              </div>
                          </div>
                          <div class="bg-sidebar-bg/30 border border-sidebar-border rounded-3xl p-5 space-y-2">
                              <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Notes</p>
                              <p id="detail-client-notes" class="text-sm text-gray-600 leading-relaxed">-</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
    <div id="create-contract-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="contract-slide-title" role="dialog" aria-modal="true">
        <div data-action="close-create-contract" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
            <div class="pointer-events-auto w-full md:w-[92%] lg:w-[75%] max-w-[1120px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-3xl overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Creation contrat</p>
                        <h2 class="text-2xl md:text-3xl font-bold text-sidebar-dark leading-tight">Creer un contrat</h2>
                    </div>
                    <button data-action="close-create-contract" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>
                <div class="bg-sidebar-bg px-8 py-4 border-b border-sidebar-border">
                        <div class="grid grid-cols-3 gap-5 text-xs">
                            <div class="flex items-center gap-3">
                            <div id="c-step-dot-1" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-sidebar-accent text-white font-semibold flex items-center justify-center text-sm">1</div>
                            <div>
                                <p class="text-xs text-sidebar-muted uppercase tracking-wider">Etape 1</p>
                                <p class="text-sm font-semibold text-sidebar-dark">Choisir le client</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div id="c-step-dot-2" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-gray-200 text-gray-500 font-semibold flex items-center justify-center text-sm">2</div>
                            <div>
                                <p class="text-xs text-sidebar-muted uppercase tracking-wider">Etape 2</p>
                                <p class="text-sm font-semibold text-sidebar-dark">Details contrat</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div id="c-step-dot-3" class="step-dot w-10 h-10 rounded-2xl border border-gray-200 bg-gray-200 text-gray-500 font-semibold flex items-center justify-center text-sm">3</div>
                            <div>
                                <p class="text-xs text-sidebar-muted uppercase tracking-wider">Etape 3</p>
                                <p class="text-sm font-semibold text-sidebar-dark">Recapitulatif</p>
                            </div>
                        </div>
                    </div>
                    <div class="step-progress-track mt-4">
                        <span id="c-step-progress-fill" class="step-progress-fill block" style="width:33%"></span>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto px-8 py-6 space-y-10">
                    <div id="c-step-content-1" class="space-y-6">
                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-500">Selectionnez un client existant ou ajoutez-en un nouveau.</p>
                            <button data-action="open-create-client" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-4 py-2 rounded-xl text-sm font-medium shadow-sm">+ Nouveau client</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select id="contract-client-select" class="w-full bg-white border border-gray-200 text-sm rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sidebar-accent/20 focus:border-sidebar-accent transition-all shadow-sm">
                                <option value="">Choisir un client...</option>
                            </select>
                        </div>
                    </div>
                    <div id="c-step-content-2" class="hidden space-y-6">
                        <p class="text-sm text-gray-500">Redigez les informations du contrat.</p>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Lieu / Site*
                                    <input type="text" id="contract-site-name" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : Residence Les Lilas"/>
                                </label>
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Adresse du lieu*
                                    <input type="text" id="contract-site-address" data-address-input class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : 12 rue du Port, 75002 Paris"/>
                                </label>
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Montant HT / mois*
                                    <input type="number" min="0" step="0.01" id="contract-amount-ht" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="1200.00"/>
                                </label>
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Taux TVA
                                    <select id="contract-vat" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                                        <option value="20">20%</option>
                                        <option value="10">10%</option>
                                        <option value="5.5">5.5%</option>
                                    </select>
                                </label>
                            </div>
                            <div class="bg-white border border-gray-100 rounded-3xl p-5 space-y-4">
                                <div class="flex items-center justify-between">
                                    <p class="text-sm font-semibold text-sidebar-dark">Contacts sur site</p>
                                    <button data-action="add-contract-contact" class="text-xs font-semibold text-sidebar-accent hover:text-sidebar-dark uppercase tracking-[0.3em]">+ Ajouter</button>
                                </div>
                                <div id="contract-contacts-container" class="space-y-3"></div>
                            </div>
                        </div>
                    </div>
                    <div id="c-step-content-3" class="hidden space-y-6">
                        <p class="text-sm text-gray-500">Verifiez les informations avant de finaliser.</p>
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 space-y-4">
                            <h3 class="text-lg font-semibold text-sidebar-dark">Montant</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-gray-400">HT / mois</p>
                                    <p id="recap-ht-month" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-gray-400">HT / an</p>
                                    <p id="recap-ht-year" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-gray-400">TTC / an</p>
                                    <p id="recap-ttc-year" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 space-y-4">
                            <h3 class="text-lg font-semibold text-sidebar-dark">Contrat</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-gray-400">Client</p>
                                    <p id="recap-contract-client" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-gray-400">Lieu</p>
                                    <p id="recap-contract-site" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="text-xs uppercase tracking-wider text-gray-400">Adresse</p>
                                    <p id="recap-contract-address" class="text-sidebar-dark font-semibold">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 space-y-3">
                            <h3 class="text-lg font-semibold text-sidebar-dark">Contacts sur site</h3>
                            <div id="recap-contract-contacts" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                    </div>
                </div>
                <div class="px-8 py-5 border-t border-gray-100 bg-white flex items-center justify-between">
                    <button id="c-btn-prev" data-action="contract-prev-step" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-3 rounded-xl font-medium transition-colors hidden">Precedent</button>
                    <div class="flex items-center gap-3 ml-auto">
                        <button id="c-btn-next" data-action="contract-next-step" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors">Suivant</button>
                        <button id="c-btn-finish" data-action="finish-contract-creation" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-medium transition-colors hidden">Terminer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
      
    <!-- MODAL EDIT CLIENT -->
      <div id="edit-client-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="edit-client-title" role="dialog" aria-modal="true">
          <div data-action="close-edit-client" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
          <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
              <div class="pointer-events-auto w-full md:w-[92%] lg:w-[70%] max-w-[1100px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                  <div class="px-8 py-6 border-b border-gray-100 flex justify-between items-start gap-4">
                      <div>
                          <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Modifier le client</p>
                          <h2 id="edit-client-title" class="text-2xl font-bold text-sidebar-dark">-</h2>
                          <p class="text-sm text-gray-500 mt-1 font-mono" id="edit-client-ref-label">-</p>
                      </div>
                      <button data-action="close-edit-client" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                          <i class="fa-solid fa-xmark text-2xl"></i>
                      </button>
                  </div>
                  <div class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Nom / Societe*
                              <input type="text" id="edit-client-name" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                          </label>
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Reference
                              <input type="text" id="edit-client-ref" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                          </label>
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Type
                              <select id="edit-client-type" data-action="edit-client-type-change" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                                  <option value="direct">Client direct</option>
                                  <option value="mandataire">Mandataire</option>
                              </select>
                          </label>
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Adresse
                              <input type="text" id="edit-client-address" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                          </label>
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Email
                              <input type="email" id="edit-client-email" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                          </label>
                          <label class="flex flex-col text-sm font-medium text-gray-600">
                              Telephone
                              <input type="tel" id="edit-client-phone" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                          </label>
                      </div>
                      <div id="edit-manager-block" class="rounded-3xl border border-gray-100 bg-white p-6 space-y-4 hidden">
                          <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Gestionnaire</p>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <label class="flex flex-col text-sm font-medium text-gray-600">
                                  Nom complet
                                  <input type="text" id="edit-manager-name" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                              </label>
                              <label class="flex flex-col text-sm font-medium text-gray-600">
                                  Email
                                  <input type="email" id="edit-manager-email" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                              </label>
                              <label class="flex flex-col text-sm font-medium text-gray-600">
                                  Telephone
                                  <input type="tel" id="edit-manager-phone" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" />
                              </label>
                          </div>
                      </div>
                  </div>
                  <div class="px-8 py-5 border-t border-gray-100 bg-white flex justify-end">
                      <button data-action="save-client-edit" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors shadow-sm">Confirmer</button>
                  </div>
              </div>
          </div>
      </div>
    <!-- MODAL REPORT CONVERSATION -->
    <div id="report-conv-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="report-conv-title" role="dialog" aria-modal="true">
        <div data-action="close-report-conv" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
            <div class="pointer-events-auto w-full md:w-[90%] lg:w-[70%] max-w-[1080px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-3xl overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Historique d'activité</p>
                        <h2 id="report-conv-title" class="text-2xl md:text-3xl font-bold text-sidebar-dark leading-tight">Signalement</h2>
                        <p id="report-conv-sub" class="text-sm text-gray-500 mt-1">-</p>
                    </div>
                    <button data-action="close-report-conv" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto px-8 py-6">
                    <div id="report-conv-list" class="relative pl-6 space-y-6">
                        <!-- timeline items injected -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MODAL CREER EMPLOYE -->
    <div id="create-employee-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="create-employee-title" role="dialog" aria-modal="true">
        <div data-action="close-create-employee" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
            <div class="pointer-events-auto w-full md:w-[90%] lg:w-[70%] max-w-[800px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Nouvel employe</p>
                        <h2 id="create-employee-title" class="text-2xl font-bold text-sidebar-dark">Creer un employe</h2>
                        <p class="text-sm text-gray-500 mt-1">Coordonnees et affectation</p>
                    </div>
                    <button data-action="close-create-employee" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Code d'activation
                            <input type="text" id="employee-code" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm bg-gray-50 text-gray-500 focus:outline-none cursor-not-allowed" readonly>
                        </label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-1">
                            <label class="flex flex-col text-sm font-medium text-gray-600 md:col-span-1">
                                Prenom*
                                <input type="text" id="employee-firstname" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Marie">
                            </label>
                            <label class="flex flex-col text-sm font-medium text-gray-600 md:col-span-1">
                                Nom*
                                <input type="text" id="employee-lastname" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Lefevre">
                            </label>
                        </div>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Email*
                            <input type="email" id="employee-email" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="email@domaine.com">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Telephone
                            <input type="tel" id="employee-phone" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="06 00 00 00 00">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600 md:col-span-2">
                            Adresse postale
                            <input type="text" id="employee-address" data-address-input class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : 12 rue du Port, 75002 Paris">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Role / Fonction
                            <input type="text" id="employee-role" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Technicien, Superviseur...">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Site / Affectation
                            <input type="text" id="employee-site" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Site Alpha Logistics">
                        </label>
                    </div>
                </div>
                <div class="px-8 py-5 border-t border-gray-100 bg-white flex justify-end">
                    <button data-action="save-employee" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors shadow-sm">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- MODAL CREER SOCIETE -->
    <div id="create-societe-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="create-societe-title" role="dialog" aria-modal="true">
        <div data-action="close-create-societe" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
            <div class="pointer-events-auto w-full md:w-[92%] lg:w-[70%] max-w-[1100px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 flex justify-between items-start gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Créer une société</p>
                        <h2 id="create-societe-title" class="text-2xl font-bold text-sidebar-dark">Créer une société</h2>
                        <p class="text-sm text-gray-500 mt-1 font-mono" id="societe-ref-label">Ref: -</p>
                    </div>
                    <button data-action="close-create-societe" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Référence (activation)
                            <input type="text" id="societe-ref" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm bg-gray-50 text-gray-600" readonly />
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Nom de la société*
                            <input type="text" id="societe-nom" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : Société Alpha">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Logo (URL)
                            <div class="mt-2 bg-gray-50 border border-dashed border-gray-200 rounded-xl p-4 flex items-center gap-4">
                                <div id="societe-logo-preview" class="w-14 h-14 rounded-xl bg-white border border-gray-200 flex items-center justify-center text-[10px] font-semibold text-gray-400 uppercase">Logo</div>
                                <div class="flex-1">
                                    <input type="file" id="societe-logo-file" accept="image/*" class="block w-full text-sm text-gray-600 file:mr-3 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sidebar-bg file:text-sidebar-dark hover:file:bg-sidebar-accent/10">
                                    <p class="text-xs text-gray-400 mt-1">PNG, JPG ou SVG - 2 Mo max.</p>
                                </div>
                            </div>
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            SIRET
                            <input type="text" id="societe-siret" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="123 456 789 00000" maxlength="18">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600 md:col-span-2">
                            Adresse postale
                            <input type="text" id="societe-adresse" data-address-input class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Ex : 12 rue du Port, 75002 Paris">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Email
                            <input type="email" id="societe-email" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="contact@societe.com">
                        </label>
                        <label class="flex flex-col text-sm font-medium text-gray-600">
                            Téléphone
                            <input type="tel" id="societe-tel" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="06 00 00 00 00">
                        </label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white border border-gray-100 rounded-3xl p-5 space-y-3">
                            <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Contact principal</p>
                            <label class="flex flex-col text-sm font-medium text-gray-600">
                                Statut
                                <input type="text" id="contact-statut" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Président, Gérant...">
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Prénom
                                    <input type="text" id="contact-prenom" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                                </label>
                                <label class="flex flex-col text-sm font-medium text-gray-600">
                                    Nom
                                    <input type="text" id="contact-nom" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                                </label>
                            </div>
                            <label class="flex flex-col text-sm font-medium text-gray-600">
                                Email
                                <input type="email" id="contact-email" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                            </label>
                            <label class="flex flex-col text-sm font-medium text-gray-600">
                                Téléphone
                                <input type="tel" id="contact-tel" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                            </label>
                        </div>
                        <div class="bg-white border border-gray-100 rounded-3xl p-5 space-y-3">
                            <p class="text-xs uppercase tracking-[0.4em] text-gray-400">Type & conditions</p>
                            <label class="flex flex-col text-sm font-medium text-gray-600">
                                Type de société
                                <select id="societe-type" class="mt-2 rounded-xl border border-gray-200 px-4 py-3 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                                    <option value="">Choisir...</option>
                                    <option>Ménage</option>
                                    <option>Dératisation / Désinsectisation</option>
                                    <option>Sécurité incendie</option>
                                    <option>Ascensoriste</option>
                                    <option>Espaces verts</option>
                                    <option>Autre</option>
                                </select>
                            </label>
                            <label class="flex flex-col text-sm font-medium text-gray-600">
                                Remise commerciale
                                <div class="grid grid-cols-2 gap-2 mt-2">
                                    <input type="number" id="remise-pct" min="0" max="100" class="rounded-xl border border-gray-200 px-3 py-2 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="%">
                                    <input type="number" id="remise-mois" min="0" class="rounded-xl border border-gray-200 px-3 py-2 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Mois">
                                </div>
                                <span class="text-xs text-gray-500 mt-1">Prix de base : 29,99 € HT / mois</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-600">
                                <input type="checkbox" id="essaie-30" class="rounded border-gray-300 text-sidebar-accent focus:ring-sidebar-accent">
                                Activer un essai 30 jours (limite 2 clients, 5 contrats, 5 employés)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="px-8 py-5 border-t border-gray-100 bg-white flex justify-end">
                    <button data-action="close-create-societe" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-3 rounded-xl font-medium transition-colors mr-2">Annuler</button>
                    <button data-action="save-societe" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors shadow-sm">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- MODAL DETAIL EMPLOYE -->
    <div id="employee-detail-modal" class="fixed inset-0 z-60 hidden" aria-labelledby="employee-detail-title" role="dialog" aria-modal="true">
        <div data-action="close-employee-detail" class="absolute inset-0 bg-gray-900/30 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>
        <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 md:pl-10 w-full">
            <div class="pointer-events-auto w-full md:w-[90%] lg:w-[70%] max-w-[1000px] ml-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-2xl flex flex-col h-full rounded-none md:rounded-l-2xl overflow-hidden">
                <div class="px-8 py-6 border-b border-gray-100 flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.6em] text-sidebar-muted">Profil employe</p>
                        <h2 id="employee-detail-name" class="text-2xl font-bold text-sidebar-dark">-</h2>
                        <p class="text-sm text-gray-500 mt-1" id="employee-detail-role">-</p>
                    </div>
                    <button data-action="close-employee-detail" class="text-gray-400 hover:text-gray-800 transition-colors p-2 rounded-xl">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
                    <div class="flex items-center gap-3">
                        <span id="employee-detail-status" class="text-xs font-bold px-2.5 py-1 rounded-full bg-gray-100 text-gray-600">Statut</span>
                        <div class="flex gap-2">
                            <button data-action="set-employee-status" data-status="Actif" data-employee-status-btn class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-gray-100 text-gray-700">Actif</button>
                            <button data-action="set-employee-status" data-status="Demission" data-employee-status-btn class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-gray-100 text-gray-700">Demission</button>
                            <button data-action="set-employee-status" data-status="Licencie" data-employee-status-btn class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-gray-100 text-gray-700">Licencie</button>
                            <button data-action="set-employee-status" data-status="Autre" data-employee-status-btn class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-gray-100 text-gray-700">Autre</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 border border-gray-100 rounded-2xl p-4 space-y-2 text-sm text-gray-700">
                            <p class="font-semibold text-sidebar-dark">Coordonnees</p>
                            <p><i class="fa-regular fa-envelope mr-2 text-gray-400"></i><span id="employee-detail-email">-</span></p>
                            <p><i class="fa-regular fa-phone mr-2 text-gray-400"></i><span id="employee-detail-phone">-</span></p>
                            <p><i class="fa-regular fa-location-dot mr-2 text-gray-400"></i><span id="employee-detail-address">-</span></p>
                            <p><i class="fa-regular fa-building mr-2 text-gray-400"></i><span id="employee-detail-site">-</span></p>
                            <p><i class="fa-regular fa-barcode mr-2 text-gray-400"></i>Code: <span id="employee-detail-code">-</span></p>
                        </div>
                        <div class="bg-white border border-gray-100 rounded-2xl p-4 space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-sidebar-dark mb-1">Salaire horaire (€)</label>
                                <input type="number" step="0.01" id="employee-detail-salary" class="w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-sidebar-dark mb-1">Contrat</label>
                                <input type="text" id="employee-detail-contract" class="w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="CDI, CDD...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-sidebar-dark mb-1">Avenant / Note</label>
                                <textarea id="employee-detail-note" rows="3" class="w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:ring-sidebar-accent focus:border-sidebar-accent" placeholder="Avenants, remarques..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-8 py-5 border-t border-gray-100 bg-white flex justify-between items-center">
                    <button data-action="delete-employee" class="text-red-500 hover:text-red-600 text-sm font-semibold">Supprimer</button>
                    <button data-action="save-employee-detail" class="bg-sidebar-dark hover:bg-sidebar-accent text-white px-5 py-3 rounded-xl font-medium transition-colors shadow-sm">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- CHANGE EMPLOYEE MODAL -->
    <div id="change-employee-modal" class="fixed inset-0 z-[60] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity" data-action="close-change-employee"></div>
        <div class="relative z-10 w-full h-full flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden transform transition-all">
                <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-sidebar-dark">Choisir un employé</h3>
                    <button data-action="close-change-employee" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <div class="p-4 max-h-96 overflow-y-auto custom-scroll space-y-2">
                    <div data-action="select-employee" data-id="1" class="flex items-center gap-3 p-3 hover:bg-sidebar-bg rounded-xl cursor-pointer transition-colors group">
                        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">T</div>
                        <div><p class="font-bold text-sm text-sidebar-dark group-hover:text-sidebar-accent">Thomas Martin</p><p class="text-xs text-gray-500">Agent d'entretien</p></div>
                    </div>
                    <div data-action="select-employee" data-id="2" class="flex items-center gap-3 p-3 hover:bg-sidebar-bg rounded-xl cursor-pointer transition-colors group">
                        <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold">J</div>
                        <div><p class="font-bold text-sm text-sidebar-dark group-hover:text-sidebar-accent">Julie Dubois</p><p class="text-xs text-gray-500">Superviseur</p></div>
                    </div>
                    <div data-action="select-employee" data-id="3" class="flex items-center gap-3 p-3 hover:bg-sidebar-bg rounded-xl cursor-pointer transition-colors group">
                        <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold">L</div>
                        <div><p class="font-bold text-sm text-sidebar-dark group-hover:text-sidebar-accent">Lucas Bernard</p><p class="text-xs text-gray-500">Technicien</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg hidden z-[60] flex items-center gap-2 w-max max-w-[90%] text-center">
        <i class="fa-solid fa-check text-green-400"></i> Action effectuée
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="./scripts/app.js" defer></script>
</body>
</html>








